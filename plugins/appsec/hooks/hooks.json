{
  "PostToolUse": [
    {
      "matcher": "ExitPlanMode",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "First, check if `.appsec/config.yaml` exists and if `hooks.plan_review` is `false`. If so, output '[appsec] Plan review disabled via config.' and stop. Otherwise: Review the implementation plan that was just approved for security concerns. Check for: missing authentication/authorization on new endpoints, input validation gaps, data exposure risks, missing encryption for sensitive data, third-party integration trust assumptions, and potential injection points. If security concerns are found, output a brief security advisory with specific issues and recommendations. If the plan looks security-sound, output a single line: '[appsec] No security concerns in plan.'"
        }
      ]
    },
    {
      "matcher": "Write|Edit",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "First, check if `.appsec/config.yaml` exists and if `hooks.secret_detection` is `false`. If so, output '[appsec] Secret detection disabled via config.' and stop. Otherwise: Quick check: scan the file that was just written or edited for patterns that look like hardcoded secrets. Look for: API keys (strings starting with sk-, pk-, AKIA, ghp_, xox), high-entropy strings assigned to variables named key/secret/token/password/credential, connection strings with embedded passwords, private key blocks (BEGIN RSA/EC/PRIVATE KEY). If a potential secret is found, warn immediately with the line number. If the file is clean, output a single line: '[appsec] No secrets detected.'"
        }
      ]
    }
  ]
}
